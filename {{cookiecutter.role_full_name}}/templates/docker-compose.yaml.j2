{%- macro var(name) -%}
{{ '{{' }}{{ name }}{{ '}}' }}
{%- endmacro -%}

---
services:
  {{cookiecutter.service_name}}:
    container_name: "{{cookiecutter.service_name}}"
    image: "{{ var(cookiecutter.service_name+"_docker_image") }}"
    restart: unless-stopped

    environment:
      - PUID={{ var(cookiecutter.service_name+"_unix_user_id") }}
      - PGID={{ var(cookiecutter.service_name+"_unix_group_id") }}
      - UMASK={{ var(cookiecutter.service_name+"_unix_umask") }}
      - TZ={{ var(cookiecutter.service_name+"_timezone") }}
      {%+raw%}{% for key,value in {%endraw%}{{cookiecutter.service_name}}_docker_env.items(){%raw%} -%}{%endraw%}
      {%raw%}
      - {{key}}={{value}}
      {% endfor +%}
      {%endraw%}

    ports:
      {%+raw%}{% for port in {%endraw%}{{cookiecutter.service_name}}_docker_ports{%raw%} -%}{%endraw%}
      {%raw%}
      {% if port != "" -%}
      - {{port}}
      {% endif -%}
      {%- endfor +%}
      {%endraw%}

    volumes:
      - "/etc/localtime:/etc/localtime:ro"
      {%+raw%}{% for volume in {%endraw%}{{cookiecutter.service_name}}_docker_volumes{%raw%} -%}{%endraw%}
      {%raw%}
      {% if volume != "" -%}
      - "{{volume}}"
      {% endif -%}
      {%- endfor %}
      {%endraw%}
      {%raw%}{% for volume in {%endraw%}{{cookiecutter.service_name}}_docker_volumes_extra{%raw%} -%}{%endraw%}
      {%raw%}
      {% if volume != "" -%}
      - "{{volume.src}}:{{volume.dst}}"
      {% endif -%}
      {%- endfor +%}
      {%endraw%}


    {%- if cookiecutter.docker_cap_net_admin %}
    cap_add:
      - NET_ADMIN
    {% endif %}


networks:
  default:
    name: "{{ var(cookiecutter.service_name+"_docker_network_name") }}"
    external: true
